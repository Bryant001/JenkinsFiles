pipeline {
    agent {
	docker {
		image 'python:latest'
		reuseNode true
		}
	}
    stages {
        //withCredentials uses credentials plugin with credentials stored in configuration
		stage('Python Stage') {
			steps {
				withCredentials([ usernamePassword (credentialsId: 'veracode_login', usernameVariable: 'VERACODE_API_ID', passwordVariable: 'VERACODE_API_KEY') ]) {
					script { 
						try {
						sh """
						pip install veracode_api_signing requests
						python --version
						python ./example.py
						"""
						} catch (err) { 
							echo 'Error code: ' + err.getMessage().substring(26)
						}
					echo 'end of test'
					}
				}
			}
		}
	}
}
